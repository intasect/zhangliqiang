/*
  This class has been generated by the Code Generator
 */

package com.laiyifen.common.core;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.BSF;
import com.cordys.cpc.bsf.busobject.QueryObject;
import java.util.ArrayList;
import com.laiyifen.common.usersync.CordysLDAPManager;
import com.laiyifen.common.usersync.DBManager;
import com.laiyifen.common.util.LaiYiFenCommunicationFailure;
import com.eibus.util.logger.CordysLogger;
import com.eibus.util.logger.Severity;

public class EMPLOYEE_INFO extends EMPLOYEE_INFOBase {
	private static CordysLogger logger = CordysLogger
			.getCordysLogger(EMPLOYEE_INFO.class);

	public EMPLOYEE_INFO() {
		this((BusObjectConfig) null);
	}

	public EMPLOYEE_INFO(BusObjectConfig config) {
		super(config);
	}

	public static com.laiyifen.common.core.EMPLOYEE_INFO getAllEmployeeInfo(
			String employeeId, String companyCode) {
		String queryText = "select * from \"EMPLOYEE_INFO_ALL\" where \"EMPLOYEEID\" = :EMPLOYEEID"
				+ " AND \"COMPANYCODE\" = :COMPANYCODE";
		QueryObject query = new QueryObject(queryText);
		query.addParameter("EMPLOYEEID", "EMPLOYEE_INFO.EMPLOYEEID",
				QueryObject.PARAM_STRING, employeeId);// NOPMD
		query.addParameter("COMPANYCODE", "EMPLOYEE_INFO.COMPANYCODE",
				QueryObject.PARAM_STRING, companyCode);// NOPMD
		query.setResultClass(EMPLOYEE_INFO.class);
		return (EMPLOYEE_INFO) query.getObject();
	}

	public static com.laiyifen.common.core.EMPLOYEE_INFO getEmployeeInfo(
			String employeeId, String companyCode) {
		String queryText = "select * from \"EMPLOYEE_INFO\" where \"EMPLOYEEID\" = :EMPLOYEEID"
				+ " AND \"COMPANYCODE\" = :COMPANYCODE";
		QueryObject query = new QueryObject(queryText);
		query.addParameter("EMPLOYEEID", "EMPLOYEE_INFO.EMPLOYEEID",
				QueryObject.PARAM_STRING, employeeId);// NOPMD
		query.addParameter("COMPANYCODE", "EMPLOYEE_INFO.COMPANYCODE",
				QueryObject.PARAM_STRING, companyCode);// NOPMD
		query.setResultClass(EMPLOYEE_INFO.class);
		return (EMPLOYEE_INFO) query.getObject();
	}
	
	public static com.laiyifen.common.core.EMPLOYEE_INFO getEmployeeInfoByCompanyCodes(
			String employeeId, String companyCodes) {
		companyCodes = getSqlInCondition(companyCodes);
        
		String queryText = "select * from EMPLOYEE_INFO where EMPLOYEEID = '" + employeeId
				+ "' AND COMPANYCODE in (" + companyCodes + ")";
		QueryObject query = new QueryObject(queryText);
		query.setResultClass(EMPLOYEE_INFO.class);
		return (EMPLOYEE_INFO) query.getObject();
	}

	public static com.laiyifen.common.core.EMPLOYEE_INFO getParttimeEmployeeInfo(
			String employeeId, String companyCode) {
		String queryText = "select * from \"EMPLOYEE_INFO_PARTTIME\" where \"EMPLOYEEID\" = :EMPLOYEEID"
				+ " AND \"COMPANYCODE\" = :COMPANYCODE";
		QueryObject query = new QueryObject(queryText);
		query.addParameter("EMPLOYEEID", "EMPLOYEE_INFO_PARTTIME.EMPLOYEEID",
				QueryObject.PARAM_STRING, employeeId);// NOPMD
		query.addParameter("COMPANYCODE", "EMPLOYEE_INFO_PARTTIME.COMPANYCODE",
				QueryObject.PARAM_STRING, companyCode);// NOPMD
		query.setResultClass(EMPLOYEE_INFO.class);
		return (EMPLOYEE_INFO) query.getObject();
	}
	
	public static com.laiyifen.common.core.EMPLOYEE_INFO getParttimeEmployeeInfoByCompanyCodes(
			String employeeId, String companyCodes) {
		
		companyCodes = getSqlInCondition(companyCodes);
        
		String queryText = "select * from EMPLOYEE_INFO_PARTTIME where EMPLOYEEID = '" + employeeId
				+ "' AND COMPANYCODE in (" + companyCodes + ")";
		
		QueryObject query = new QueryObject(queryText);

		query.setResultClass(EMPLOYEE_INFO.class);
		return (EMPLOYEE_INFO) query.getObject();
	}

	/**
	 * @throws LaiYiFenCommunicationFailure
	 * 
	 **/
	@SuppressWarnings("deprecation")
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getEmployeeInfoByRoleDN(
			String roleName) throws LaiYiFenCommunicationFailure {
		String roleTempName = "cn=" + roleName + ",cn=organizational roles," + BSF.getOrganization();
		logger.log(Severity.ERROR, "getEmployeeInfoByRoleDN:" + roleTempName, null);
		String tempUserList = com.laiyifen.common.util.AssignmentUtils
				.getUsersForFunctionalRole(roleTempName);
		logger.log(Severity.ERROR, "getEmployeeInfoByRoleDN:" + tempUserList, null);
		String queryText = "select EMPLOYEEID, SN||GIVENNAME AS SN, STATION,STATIONCODE,DEPTID,DEPTNAME,COMPANYCODE,COMPANY_NAME as  WORKAREA from  EMPLOYEE_INFO,ORG_COMPANY_INFO  where   EMPLOYEE_INFO.COMPANYCODE=ORG_COMPANY_INFO.COMPANY_CODE AND PERSONALSTATUS='0' AND EMPLOYEEID IN("
				+ getSqlUser(tempUserList) + ")";

		QueryObject query = new QueryObject(queryText);
		query.setResultClass(EMPLOYEE_INFO.class);
		return query.getObjects();
	}

	/**
	 * 将以;进行分割的用户转换为'user1';'user2'方式
	 **/
	private static String getSqlUser(String userList) {
		StringBuffer strBuf = new StringBuffer("");

		if (userList == ""){
			return "''";
		}
		String[] strArray = userList.split(";");
		for (int i = 0; i < strArray.length; i++) {
			String tempempCode = strArray[i];
			strBuf.append("'").append(tempempCode.substring(3, tempempCode.indexOf(','))).append("'");
			if (i < (strArray.length - 1)){
				strBuf.append(",");
			}
		}
		return strBuf.toString();
	}
	
	/**
	 * 将以;进行分割拼装In条件查询参数
	 **/
	private static String getSqlInCondition(String conditionStrs) {
		StringBuffer sb = new StringBuffer("");
        if(conditionStrs != null){
        	String[] params = conditionStrs.split(";");
        	for(String param : params){
        		sb.append("'").append(param).append("'").append(",");
        	}
        }
		return sb.toString().substring(0,sb.toString().length()-1);
	}

	public static void syncCordysUsersFromDB() throws Exception {
		
		DBManager dbManager = new DBManager();

		ArrayList<EMPLOYEE_INFO_TRANS> usersPartInfo = dbManager.getAllUsers();

		// sync data to cordys
		CordysLDAPManager cordysLDAPManager = new CordysLDAPManager();
		cordysLDAPManager.importUsers(usersPartInfo, dbManager, cordysLDAPManager);
		cordysLDAPManager.dispose();
		dbManager.dispose();
	}
	
	//Functions for search manager
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByEmployeeId(String employeeId)
    {
        //String queryText = "select t.* from EMPLOYEE_INFO t,EMPLOYEE_INFO t1 where t.employeeid = t1.managernumber and t.employeeid <> t.managernumber and t1.employeeid = '" + employeeId + "'";
        String queryText = "select t.* from EMPLOYEE_INFO t,EMPLOYEE_INFO t1 where t.employeeid = t1.managernumber and t1.employeeid = '" + employeeId + "'";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByUserDn(String userDn)
    {
        if(!userDn.startsWith("cn=")){
        	return null;
        }
		String employeeId = userDn.split(",")[0].substring(3);
		return getManagersByEmployeeId(employeeId);
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByDeptId(String deptId)
    {
        String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid = t.managernumber and t.deptid = '" + deptId + "'";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByEmployeeIdAndLevel(String employeeId, int level)
    {
        String queryText = "select t2.* from EMPLOYEE_INFO t2 where t2.deptid in (select t1.dept_id from ORG_DEPARTMENT_INFO t1 where level = " + level + " start with t1.dept_id in (select t.deptid from EMPLOYEE_INFO t where t.employeeid = '" + employeeId + "') connect by prior t1.parent_id = t1.dept_id) and t2.employeeid = t2.managernumber";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByUserDnAndLevel(String userDn, int level)
    {
		if(!userDn.startsWith("cn=")){
        	return null;
        }
		String employeeId = userDn.split(",")[0].substring(3);
		
		return getManagersByEmployeeIdAndLevel(employeeId, level);
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getManagersByDeptIdAndLevel(String deptId, int level)
    {
        String queryText = "select t2.* from EMPLOYEE_INFO t2 where t2.deptid in (select t1.dept_id from ORG_DEPARTMENT_INFO t1 where level = " + level + " start with t1.dept_id = '" + deptId + "' connect by prior t1.parent_id = t1.dept_id) and t2.employeeid = t2.managernumber";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByEmployeeId(String employeeId)
    {
		String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid = '" + employeeId + "'";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	//employeeIds以;进行分割
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByEmployeeIds(String employeeIds)
    {
		String inCondition = getSqlUser(employeeIds);
		
		String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid in (" + inCondition + ")";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByUserDn(String userDn)
    {
		if(!userDn.startsWith("cn=")){
        	return null;
        }
		String employeeId = userDn.split(",")[0].substring(3);
        
		return getUsersByEmployeeId(employeeId);
    }
	
	//userDns以;进行分割
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByUserDns(String userDns)
    {
        String inCondition = getSqlUser(userDns);
        
		String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid in (" + inCondition + ")";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByUserDnsAndCompanyCode(String userDns, String companyCode)
    {
        String inCondition = getSqlUser(userDns);
        
		String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid in (" + inCondition + ") and t.COMPANYCODE = '" + companyCode + "'";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getUsersByUserDnsAndCompanyCodes(String userDns, String companyCodes)
    {
		companyCodes = getSqlInCondition(companyCodes);
		String inCondition = getSqlUser(userDns);
		
		String queryText = "select t.* from EMPLOYEE_INFO t where t.employeeid in (" + inCondition + ") and t.COMPANYCODE in (" + companyCodes + ")";
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getEmployeeByDeptid(String DEPTID, com.cordys.cpc.bsf.query.Cursor cursor)
    {
		String queryText = "SELECT * FROM \"EMPLOYEE_INFO\" WHERE \"DEPTID\" = :DEPTID";
        QueryObject query = new QueryObject(queryText);
        query.addParameter("DEPTID", "EMPLOYEE_INFO.DEPTID", QueryObject.PARAM_STRING, DEPTID);
        query.setResultClass(EMPLOYEE_INFO.class);
        query.setCursor(cursor);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getEmployeeByFilters(String EMPLOYEEID, String NAME, String DEPTID, String PRINCIPALDEPT, String COMPANYCODE, String PERSONALSTATUS, String STATIONCODE, String MANAGERNUMBER, com.cordys.cpc.bsf.query.Cursor cursor)
    {
		String queryText = "SELECT * FROM \"EMPLOYEE_INFO\" WHERE 1=1";
        if(EMPLOYEEID.equals("") != true){
        	queryText += "AND EMPLOYEEID = '" +EMPLOYEEID+"'";
        }
        if(NAME.equals("") != true){
        	queryText += "AND SN||GIVENNAME LIKE '%" +NAME+"%'";
        }
        if(DEPTID.equals("") != true){
        	queryText += "AND DEPTID = '" +DEPTID+"'";
        }
        if(PRINCIPALDEPT.equals("") != true){
        	queryText += "AND PRINCIPALDEPT = '" +PRINCIPALDEPT+"'";
        }
        if(COMPANYCODE.equals("") != true){
        	queryText += "AND COMPANYCODE = '" +COMPANYCODE+"'";
        }
        if(PERSONALSTATUS.equals("") != true){
        	queryText += "AND PERSONALSTATUS = '" +PERSONALSTATUS+"'";
        }
        if(STATIONCODE.equals("") != true){
        	queryText += "AND STATIONCODE = '" +STATIONCODE+"'";
        }
        if(MANAGERNUMBER.equals("") != true){
        	queryText += "AND MANAGERNUMBER = '" +MANAGERNUMBER+"'";
        }
        QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        query.setCursor(cursor);
        return query.getObjects();
    }
	
	public static BusObjectIterator<com.laiyifen.common.core.EMPLOYEE_INFO> getEmployeeByIdAndName(String EMPLOYEEID, String NAME)
    {
		String queryText = "SELECT DISTINCT EMPLOYEEID, SN, GIVENNAME FROM \"EMPLOYEE_INFO\" WHERE PERSONALSTATUS !='1'";
		if(EMPLOYEEID.equals("") != true){
        	queryText += "AND EMPLOYEEID LIKE '%" +EMPLOYEEID+"%'";
        }
		if(NAME.equals("") != true){
        	queryText += "AND SN||GIVENNAME LIKE '%" +NAME+"%'";
        }
		QueryObject query = new QueryObject(queryText);
        query.setResultClass(EMPLOYEE_INFO.class);
        return query.getObjects();
    }
}