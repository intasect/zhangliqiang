
/*
  This class has been generated by the Code Generator
*/

package com.laiyifen.common.core;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.laiyifen.common.attachment.delete.DeleteInterface;
import com.laiyifen.common.attachment.download.DownloadInterface;
import com.laiyifen.common.attachment.upload.UploadInterface;
import com.laiyifen.common.exceptions.LYFException;
import com.laiyifen.common.util.GUIDUtil;

public class ATTACHMENT extends ATTACHMENTBase
{
	private GUIDUtil guidGenerator = null;
    private String guidValue = null;
    
    public ATTACHMENT()
    {
        this((BusObjectConfig)null);
    }

    public ATTACHMENT(BusObjectConfig config)
    {
        super(config);
    }
    
    public void onBeforeInsert() {
    	if(guidGenerator == null)
		{
			guidGenerator = new GUIDUtil();
		}
		if(guidValue == null)
		{
			guidValue=guidGenerator.setGUID(null);
		}
		User userInfo = null;
    	if(this.getID()==null ||this.getID().equals("")){
 		   this.setID(guidValue);
 		}
    	if(this.getUPLOAD_DATE()==null || this.getUPLOAD_DATE().equals("")){
    	   this.setUPLOAD_DATE(new java.util.Date());
    	}
    	if(this.getOPERATOR_CODE()==null || this.getOPERATOR_CODE().equals("")){
    		if(userInfo == null)
				userInfo = com.laiyifen.common.core.User.getUserInfo();
    		this.setOPERATOR_CODE(userInfo.getUserCode());
    	}
    	if(this.getOPERATOR_NAME()==null || this.getOPERATOR_NAME().equals("")){
    		if(userInfo == null)
				userInfo = com.laiyifen.common.core.User.getUserInfo();
    		this.setOPERATOR_NAME(userInfo.getUserName());
    	}
    	if(this.getDEPT_CODE()==null || this.getDEPT_CODE().equals("")){
    		if(userInfo == null)
				userInfo = com.laiyifen.common.core.User.getUserInfo();
    		this.setDEPT_CODE(userInfo.getDeptCode());	
    	}
    	if(this.getDEPTMENT_NAME()==null || this.getDEPTMENT_NAME().equals("")){
    		if(userInfo == null)
				userInfo = com.laiyifen.common.core.User.getUserInfo();
    		this.setDEPTMENT_NAME(userInfo.getDeptName());	
    	}
    }
    
    private static DeleteInterface deleteManager =UploadFactory.getDeleteManager();
    private static DownloadInterface downloadManager =UploadFactory.getDownloadManager();
    private static UploadInterface uploadManager =UploadFactory.getUploadManager();

    public static void deleteFile(String guid) throws LYFException
    {
    	deleteManager.deleteFile(guid);
    }

    public static String downloadFile(String id) throws LYFException
    {
    	return downloadManager.downloadFile(id);
    }

    public static String uploadFile(String fileFullName, String fileContent, String directory, String fileType) throws LYFException
    {
    	return uploadManager.uploadFile(fileFullName,fileContent,directory,fileType);
    }
    
    public static BusObjectIterator<com.laiyifen.common.core.ATTACHMENT> getAttachment(String Form_ID)
    {
    	 String queryText = "select * from \"ATTACHMENT\" where \"FORM_ID\" = :Form_ID order by UPLOAD_DATE";
         QueryObject query = new QueryObject(queryText);
         query.addParameter("Form_ID", "ATTACHMENT.FORM_ID", QueryObject.PARAM_STRING,Form_ID);
         query.setResultClass(ATTACHMENT.class);
         return query.getObjects();
    }
}