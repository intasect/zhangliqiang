/*
  This class has been generated by the Code Generator
*/

package com.laiyifen.shop;

import java.util.Date;
import java.util.Vector;

import com.cordys.cpc.bsf.busobject.BusObjectArray;
import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.laiyifen.common.util.GUIDUtil;


public class SHOP_ANNUALPLAN_DETAILS extends SHOP_ANNUALPLAN_DETAILSBase
{
    public SHOP_ANNUALPLAN_DETAILS()
    {
        this((BusObjectConfig)null);
    }

    public SHOP_ANNUALPLAN_DETAILS(BusObjectConfig config)
    {
        super(config);
    }

    /**
     * 根据条件(YEAR, AREA, LOCATION, USER_DN, HeadquarterFlag)进行SHOP_ANNUALPLAN_DETAILS记录的查询
     * @param YEAR 年度
     * @param AREA1 区域
     * @param AREA2 地区
     * @param USER_DN 用户DN
     * @param HeadquarterFlag 总部标志 true：总部人员, 其他：分公司人员
     * @return
     */
    public static BusObjectIterator<com.laiyifen.shop.SHOP_ANNUALPLAN_DETAILS> getShopAnnualPlanDetailsByFilter(String YEAR, String AREA1, String AREA2, String USER_CODE, String HeadquarterFlag)
    {
    	Vector result = new Vector();
    	// 根据YEAR, AREA, USER_DN, HeadquarterFlag先查询出SHOP_ANNUALPLAN对应的FORM_ID
    	BusObjectIterator shopAnnualPlans = SHOP_ANNUALPLAN.getShopAnnualPlanByFilter(YEAR, AREA1, USER_CODE, HeadquarterFlag);
    	if(null != shopAnnualPlans){
    		while(shopAnnualPlans.hasMoreElements()){
    			SHOP_ANNUALPLAN plan = (SHOP_ANNUALPLAN)shopAnnualPlans.nextElement(); 
    			BusObjectIterator detailses = SHOP_ANNUALPLAN_DETAILS.getShopAnnualPlanDetailsByFormId(plan.getFORM_ID());
    			if(null != detailses){
					while(detailses.hasMoreElements()){
						SHOP_ANNUALPLAN_DETAILS detailes = (SHOP_ANNUALPLAN_DETAILS)detailses.nextElement();
						// 根据AREA进行记录的过滤
						if("".equals(AREA2)){
							result.add(detailes);
		    			} else {
		    				if(!detailes.isNull(ATTR_AREA)){
			    				if(AREA2.trim().equals(detailes.getAREA().trim())){
			    					result.add(detailes);	
			    				}
		    				}
		    			}
					}
				}
    		}
    	}
    	return new BusObjectArray(result);
    }

    /**
     * 根据外键FORM_ID进行SHOP_ANNUALPLAN_DETAILS记录的查询
     * @param FORM_ID
     * @return
     */
    public static BusObjectIterator<com.laiyifen.shop.SHOP_ANNUALPLAN_DETAILS> getShopAnnualPlanDetailsByFormId(String FORM_ID)
    {
    	String queryText = "select * from \"SHOP_ANNUALPLAN_DETAILS\" where \"FORM_ID\" = :FORM_ID";
        QueryObject query = new QueryObject(queryText);
        query.addParameter("FORM_ID", "SHOP_ANNUALPLAN_DETAILS.FORM_ID", QueryObject.PARAM_STRING, FORM_ID);
        query.setResultClass(SHOP_ANNUALPLAN_DETAILS.class);
        return query.getObjects();
    }

	/**
	 * 表SHOP_ANNUALPLAN_DETAILS增加记录时执行
	 */
	@Override
	public void onInsert() {
		// 设置主键ID
		GUIDUtil util = new GUIDUtil();
		util.setGUID(null);
		String id = util.getGUID();
		this.setID(id);
	}

	/**
	 * 表SHOP_ANNUALPLAN_DETAILS更新记录时执行
	 */
	@Override
	public void onUpdate() {
		Date now = new Date();
		this.setCHECKER_TIMES(now);
	}
}
