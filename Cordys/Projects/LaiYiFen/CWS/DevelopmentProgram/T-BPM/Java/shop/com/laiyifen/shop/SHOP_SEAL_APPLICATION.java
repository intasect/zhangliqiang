/*
  This class has been generated by the Code Generator
*/

package com.laiyifen.shop;

import java.text.SimpleDateFormat;
import java.util.Date;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.BusObjectManager;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.cordys.cpc.bsf.event.AccessMode;
import com.cordys.cpc.bsf.event.AfterAttributeChangeEvent;
import com.cordys.cpc.bsf.event.AttributeAccessEvent;
import com.cordys.cpc.bsf.event.AttributeInitializeEvent;
import com.cordys.cpc.bsf.event.BeforeCommitObjectEvent;
import com.laiyifen.common.core.APPROVAL_HISTORY;
import com.laiyifen.common.core.ATTACHMENT;
import com.laiyifen.common.core.User;
import com.eibus.util.logger.CordysLogger;
import com.eibus.util.logger.Severity;



public class SHOP_SEAL_APPLICATION extends SHOP_SEAL_APPLICATIONBase
{
	private static CordysLogger logger = CordysLogger.getCordysLogger(SHOP_SEAL_APPLICATION.class);	
	
	private User userObj = null;

	  
    public SHOP_SEAL_APPLICATION()
    {
        this((BusObjectConfig)null);
    }

    public SHOP_SEAL_APPLICATION(BusObjectConfig config)
    {
        super(config);
    }
    
    public User getCurrUserInfo()
    {
    	if( this.userObj==null)
    	{
    		this.userObj= User.getUserInfo();
    	}
    	
    	return this.userObj;

    }
    
    
    @SuppressWarnings({ "unchecked", "static-access" })
	@Override
    public void onBeforeCommit(BeforeCommitObjectEvent event) {

    	super.onBeforeCommit(event);
    	
    	BusObjectIterator<SUPPLIERS_MASTER> suppliersMasterObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(SUPPLIERS_MASTER.class);
    	while(suppliersMasterObjects.hasMoreElements())
    	{
    		SUPPLIERS_MASTER suppliersMasterObject = (SUPPLIERS_MASTER)suppliersMasterObjects.nextElement();
    		suppliersMasterObject.setAttributeValueIntegrity(this, this.ATTR_SHOP_ID, SUPPLIERS_MASTER.ATTR_SHOP_ID);
    	}
    	
    	BusObjectIterator<APPROVAL_HISTORY> approvalHistoryObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(APPROVAL_HISTORY.class);
    	while(approvalHistoryObjects.hasMoreElements())
    	{
    		APPROVAL_HISTORY approvalHistoryObject = (APPROVAL_HISTORY)approvalHistoryObjects.nextElement();
    		approvalHistoryObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, APPROVAL_HISTORY.ATTR_FORM_ID);
    	}
    	
    	BusObjectIterator<ATTACHMENT> attachmentObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(ATTACHMENT.class);
    	while(attachmentObjects.hasMoreElements())
    	{
    		ATTACHMENT attachmentObject = (ATTACHMENT)attachmentObjects.nextElement();
    		attachmentObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, ATTACHMENT.ATTR_FORM_ID);
    	}
    }
    
    
    public static BusObjectIterator<com.laiyifen.shop.SHOP_SEAL_APPLICATION> getSelectShopSealAppObjects(String amount, String seal_name, String collaborators, java.util.Date seal_date_begin, java.util.Date seal_date_end, com.cordys.cpc.bsf.query.Cursor cursor)
    {
    	StringBuffer queryText = new StringBuffer();
    	queryText.append("select * from \"SHOP_SEAL_APPLICATION\" where 1=1 ");
    	
    	if (null != amount && !("".equals(amount)) && "" != amount)
    	{
    		queryText.append("and \"AMOUNT\" = :amount ");
    	}
		if (null != seal_name && !("".equals(seal_name)) && "" != seal_name) 
		{
			queryText.append("and \"SEAL_NAME\" = :seal_name ");
		}
		if (null != collaborators && !("".equals(collaborators)) && "" != collaborators) 
		{
			queryText.append("and \"COLLABORATORS\" = :collaborators ");
		}
		if (null != seal_date_begin) 
		{
			queryText.append("and  to_char(SEAL_DATE ,'yyyy-MM-dd') >= :seal_date_begin ");
		}
		if (null != seal_date_end) 
		{
			queryText.append("and  to_char(SEAL_DATE ,'yyyy-MM-dd') <= :seal_date_end");
		}

		QueryObject query = new QueryObject(queryText.toString());

		if (null != amount && !("".equals(amount)) && "" != amount)
		{
			query.addParameter("amount", "SHOP_SEAL_APPLICATION.AMOUNT", QueryObject.PARAM_STRING, amount);
		}
		if (null != seal_name && !("".equals(seal_name)) && "" != seal_name) 
		{
			query.addParameter("seal_name",	"SHOP_SEAL_APPLICATION.SEAL_NAME", QueryObject.PARAM_STRING, seal_name);
		}
		if (null != collaborators && !("".equals(collaborators)) && "" != collaborators) 
		{
			query.addParameter("collaborators",	"SHOP_SEAL_APPLICATION.COLLABORATORS", QueryObject.PARAM_STRING, collaborators);
		}
		if (null != seal_date_begin) 
		{
			SimpleDateFormat sDateFormat = new SimpleDateFormat("yyyy-MM-dd");
			String datebegin = sDateFormat.format(seal_date_begin);
			query.addParameter("seal_date_begin", "SHOP_SEAL_APPLICATION.APPLICATION_DATE", QueryObject.PARAM_STRING, datebegin);
		}
		if (null != seal_date_end) 
		{
			SimpleDateFormat sDateFormat = new SimpleDateFormat("yyyy-MM-dd");
			String dateend = sDateFormat.format(seal_date_end);
			query.addParameter("seal_date_end", "SHOP_SEAL_APPLICATION.SEAL_DATE", QueryObject.PARAM_STRING, dateend);
		}

		query.setResultClass(SHOP_SEAL_APPLICATION.class);
		return query.getObjects();
	}

    public static com.laiyifen.shop.SHOP_SEAL_APPLICATION getShopIdSealAppObject(String shopId)
    {
    	String queryText = "select * from \"SHOP_SEAL_APPLICATION\" where \"SHOP_ID\" = :shopId";
        QueryObject query = new QueryObject(queryText);
        query.addParameter("shopId", "SHOP_SEAL_APPLICATION.SHOP_ID", QueryObject.PARAM_STRING, shopId);
        query.setResultClass(SHOP_SEAL_APPLICATION.class);
        return (SHOP_SEAL_APPLICATION)query.getObject();
    }
    
    
    
    /*
     * 控制是否修改.
     */
    public void onDisplay_USER_NAME(AttributeAccessEvent context){
    	context.setAccess(AccessMode.READONLY);
    }
    /*
     * 输入框改变时，给提示信息.
     */
    public void onAfterChange_CITY(AfterAttributeChangeEvent event)
    {
    	//this.setCITY("This is shanghai city");
    }
    /*
     * 初始化用户信息
     */
    // 用户姓名
    public void onInitialize_USER_NAME(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getUserName());
    }
    //用户代码
    public void onInitialize_USER_CODE(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getUserCode());
    }
    //部门名称
    public void onInitialize_DEPARTMENT_NAME(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getDeptName());
    }
    //部门代码
    public void onInitialize_DEPARTMENT_CODE(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getDeptCode());
    }
    
    //子公司代码
    public void onInitialize_SUBCOMPANY_CODE(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getCompanyCode());
    }
	//子公司名称
    public void onInitialize_SUBCOMPANY_NAME(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getCompanyName());
    }
    
    //创建时间
    public void onInitialize_APPLICATION_DATE(AttributeInitializeEvent context){
    	SimpleDateFormat sDateFormat = new SimpleDateFormat("yyyy-MM-dd");      
    	String date = sDateFormat.format(new Date());
    	context.setInitialValue(date);
    }


}
