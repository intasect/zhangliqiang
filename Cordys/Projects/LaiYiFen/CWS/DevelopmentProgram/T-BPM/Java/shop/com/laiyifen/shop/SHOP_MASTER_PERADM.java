/*
  This class has been generated by the Code Generator
*/

package com.laiyifen.shop;

import java.text.SimpleDateFormat;
import java.util.Date;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.BusObjectManager;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.cordys.cpc.bsf.event.AccessMode;
import com.cordys.cpc.bsf.event.AttributeAccessEvent;
import com.cordys.cpc.bsf.event.AttributeInitializeEvent;
import com.cordys.cpc.bsf.event.BeforeCommitObjectEvent;
import com.eibus.xml.nom.Node;
import com.eibus.xml.xpath.XPath;
import com.laiyifen.common.core.ATTACHMENT;
import com.laiyifen.common.core.User;


public class SHOP_MASTER_PERADM extends SHOP_MASTER_PERADMBase
{
	private User userObj = null;
    public SHOP_MASTER_PERADM()
    {
        this((BusObjectConfig)null);
    }

    public SHOP_MASTER_PERADM(BusObjectConfig config)
    {
        super(config);
    }

    public static com.laiyifen.shop.SHOP_MASTER_PERADM getShopMasterPeradmByShopId(String shopId)
    {
    	StringBuffer queryText = new StringBuffer();
    	QueryObject query = null;   	
    	queryText.append("select * from SHOP_MASTER_PERADM where \"SHOP_ID\" = :SHOP_ID ");	
    	query = new QueryObject(queryText.toString());
    	query.addParameter("SHOP_ID", "SHOP_MASTER_PERADM.SHOP_ID", QueryObject.PARAM_STRING, shopId);
        query.setResultClass(SHOP_MASTER_PERADM.class);
        return (SHOP_MASTER_PERADM)query.getObject();
    }
    
    @SuppressWarnings({ "unchecked", "static-access" })
	@Override
    public void onBeforeCommit(BeforeCommitObjectEvent event) {

    	super.onBeforeCommit(event);  	 
    	BusObjectIterator<ATTACHMENT> attachmentObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(ATTACHMENT.class);
    	while(attachmentObjects.hasMoreElements())
    	{
    		ATTACHMENT attachmentObject = (ATTACHMENT)attachmentObjects.nextElement();
    		attachmentObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, ATTACHMENT.ATTR_FORM_ID);
    	}
    } 
    /*
    *
    * 初始化用户信息
    */
       public void onInitialize_USER_NAME(AttributeInitializeEvent context){
       	context.setInitialValue(this.getCurrUserInfo().getUserName());
       }
       public void onInitialize_DEPARTMENT_NAME(AttributeInitializeEvent context){
       	context.setInitialValue(this.getCurrUserInfo().getDeptName());
       }
       public void onInitialize_DEPARTMENT_CODE(AttributeInitializeEvent context){
       	context.setInitialValue(this.getCurrUserInfo().getDeptCode());
       }
       public void onInitialize_USER_DN(AttributeInitializeEvent context){
       	context.setInitialValue(this.getCurrUserInfo().getUserDN());
       }
       public void onInitialize_USER_CODE(AttributeInitializeEvent context){
       	context.setInitialValue(this.getCurrUserInfo().getUserCode());
       }
     //创建时间
       public void onInitialize_APPLICATION_DATE(AttributeInitializeEvent context){
       	SimpleDateFormat sDateFormat = new SimpleDateFormat("yyyy-MM-dd");      
       	String date = sDateFormat.format(new Date());
       	context.setInitialValue(date);
       }
       
       /*
        * 控制用户名只可读.
        */
       public void onDisplay_USER_NAME(AttributeAccessEvent context){
       	context.setAccess(AccessMode.READONLY);
       }
       /*
        * 控制用户编码只可读.
        */
       public void onDisplay_USER_CODE(AttributeAccessEvent context){
       	context.setAccess(AccessMode.READONLY);
       }
       /*
        * 控制部门名称只可读.
        */
       public void onDisplay_DEPARTMENT_NAME(AttributeAccessEvent context){
       	context.setAccess(AccessMode.READONLY);
       }
       /*
        * 控制填写时间只可读.
        */
       public void onDisplay_APPLICATION_DATE(AttributeAccessEvent context){
       	context.setAccess(AccessMode.READONLY);
       }
       
       public User getCurrUserInfo(){
       	if( this.userObj==null){        		
       	   this.userObj= com.laiyifen.common.core.User.getUserInfo();   
       	}
       	return this.userObj;
       }
       
       /**
        * 修改HR组织代码
        * @param SHOP_ID
        * @param xmlRETURN
        * @return
        */
       public static com.laiyifen.shop.SHOP_MASTER_PERADM updateHR_ORGANIZATION_CODE(String SHOP_ID, int xmlRETURN){
    	   String hrOrganizationCode = Node.getData(XPath.getFirstMatch(".//responsedata/RETURN/item/MESSAGE", null, xmlRETURN));
    	   SHOP_MASTER_PERADM shopMasterPerAdm = SHOP_MASTER_PERADM.getShopMasterPeradmByShopId(SHOP_ID);
    	   if(null != shopMasterPerAdm){
	    	   shopMasterPerAdm.setHR_ORGANIZATION_CODE(hrOrganizationCode);
	    	   shopMasterPerAdm.update();
    	   }
    	   return shopMasterPerAdm;
       }
}
