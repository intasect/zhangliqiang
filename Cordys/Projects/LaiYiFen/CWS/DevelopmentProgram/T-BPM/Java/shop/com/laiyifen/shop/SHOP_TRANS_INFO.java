/*
  This class has been generated by the Code Generator
*/

package com.laiyifen.shop;

import com.cordys.cpc.bsf.busobject.BusObjectConfig;
import com.cordys.cpc.bsf.busobject.BusObjectIterator;
import com.cordys.cpc.bsf.busobject.BusObjectManager;
import com.cordys.cpc.bsf.busobject.QueryObject;
import com.cordys.cpc.bsf.event.AccessMode;
import com.cordys.cpc.bsf.event.AttributeAccessEvent;
import com.cordys.cpc.bsf.event.AttributeInitializeEvent;
import com.cordys.cpc.bsf.event.BeforeCommitObjectEvent;
import com.laiyifen.common.core.APPROVAL_HISTORY;
import com.laiyifen.common.core.ATTACHMENT;
import com.laiyifen.common.core.User;
import com.laiyifen.common.util.CommonUtil;


public class SHOP_TRANS_INFO extends SHOP_TRANS_INFOBase
{
	private User userObj = null;
	
	public SHOP_TRANS_INFO()
    {
        this((BusObjectConfig)null);
    }

    public SHOP_TRANS_INFO(BusObjectConfig config)
    {
        super(config);
    }
    
    /**
     * 获取当前人的基本信息
     * @param 
     * @return
     */
    public User getCurrUserInfo()
    {
    	if( this.userObj==null)
    	{
    		this.userObj= User.getUserInfo();
    	}
    	
    	return this.userObj;

    }
    
    /**
     * 通过shopID获取shopTransInfo数据
     * @param shopID	门店ID
     * @return SHOP_TRANS_INFO对象
     */
    public static com.laiyifen.shop.SHOP_TRANS_INFO getShopTransInfoByShopId(String shopID)
    {
    String queryText = "select * from \"SHOP_TRANS_INFO\" where \"SHOP_ID\" = :SHOP_ID";
        QueryObject query = new QueryObject(queryText);
        query.addParameter("SHOP_ID", "SHOP_TRANS_INFO.SHOP_ID", QueryObject.PARAM_STRING, shopID);
        query.setResultClass(SHOP_TRANS_INFO.class);
        return (SHOP_TRANS_INFO)query.getObject();
    }
    
    /**
     * 通过查询条件获取新开店信息移交单查询页面的数据
     * @param shopNo	门店编号
     * @param shopName	门店名称
     * @param subCompany	所属子公司
     * @param startDate	创建开始时间
     * @param endDate	创建结束时间
     * @return SHOP_TRANS_INFO对象
     */
    public static BusObjectIterator<com.laiyifen.shop.SHOP_TRANS_INFO> getShopTransObjectsByConditions(String shopNo, String shopName, String subCompany, String startDate, String endDate)
    {
		StringBuffer queryText = new StringBuffer();
        queryText.append("select m.shop_id,m.shop_no user_code,m.shop_name user_name,m.shop_serialno department_code,m.shop_attr_name department_name,t.subcompany_name,t.create_time,t.form_type " +
				"from SHOP_TRANS_INFO t,SHOP_MASTER m " +
				"where m.shop_id = t.shop_id ");
        if(shopNo!=null && !shopNo.trim().equals("")){
			queryText.append("and m.shop_no like '%").append(shopNo).append("%' ");
		}
        if(shopName!=null && !shopName.trim().equals("")){
			queryText.append("and m.shop_name like '%").append(shopName).append("%' ");
		}
        if(subCompany!=null && !subCompany.trim().equals("")){
			queryText.append("and t.subcompany_name like '%").append(subCompany).append("%' ");
		}	
		if(startDate!=null && !startDate.trim().equals("")){
			queryText.append("and t.create_time >= to_date('").append(startDate).append("','yyyy-MM-dd') ");
		}
		if(endDate!=null && !endDate.trim().equals("")){
			queryText.append("and t.create_time <= to_date('").append(endDate).append("','yyyy-MM-dd')");
		}
		QueryObject query = new QueryObject(queryText.toString());
		query.setResultClass(SHOP_TRANS_INFO.class);
		return query.getObjects();
    }

    @SuppressWarnings({ "unchecked", "static-access" })
    /**
     * 提交SHOP_TRANS_INFO前将FORM_ID赋值给其他关联对象.
     * @param event	
     * @return
     */
	public void onBeforeCommit(BeforeCommitObjectEvent event) {

    	super.onBeforeCommit(event);
    	
    	BusObjectIterator<SHOP_TRANS_ENG> ShopTransEngObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(SHOP_TRANS_ENG.class);
    	while(ShopTransEngObjects.hasMoreElements())
    	{
    		SHOP_TRANS_ENG ShopTransEngObject = (SHOP_TRANS_ENG)ShopTransEngObjects.nextElement();
    		ShopTransEngObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, SHOP_TRANS_ENG.ATTR_FORM_ID);
         }
    	
    	BusObjectIterator<SHOP_TRANS_DISTRIBUTION> shopTransDistributionObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(SHOP_TRANS_DISTRIBUTION.class);
    	while(shopTransDistributionObjects.hasMoreElements())
    	{
    		SHOP_TRANS_DISTRIBUTION shopTransDistributionObject = (SHOP_TRANS_DISTRIBUTION)shopTransDistributionObjects.nextElement();
    		shopTransDistributionObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, SHOP_TRANS_DISTRIBUTION.ATTR_FORM_ID);
    	}
    	
    	BusObjectIterator<APPROVAL_HISTORY> approvalHistoryObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(APPROVAL_HISTORY.class);
    	while(approvalHistoryObjects.hasMoreElements())
    	{
    		APPROVAL_HISTORY approvalHistoryObject = (APPROVAL_HISTORY)approvalHistoryObjects.nextElement();
    		approvalHistoryObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, APPROVAL_HISTORY.ATTR_FORM_ID);
    	}
    	
    	BusObjectIterator<ATTACHMENT> attachmentObjects = this.getObjectManager().getObjects(BusObjectManager.SCOPE_TRANSACTION).getObjectsByType(ATTACHMENT.class);
    	while(attachmentObjects.hasMoreElements())
    	{
    		ATTACHMENT attachmentObject = (ATTACHMENT)attachmentObjects.nextElement();
    		attachmentObject.setAttributeValueIntegrity(this, this.ATTR_FORM_ID, ATTACHMENT.ATTR_FORM_ID);
    	}
    }
    
    /**
     * 初始化用户名
     * @param context	
     * @return
     */
    public void onInitialize_USER_NAME(AttributeInitializeEvent context){
    	context.setInitialValue(this.getCurrUserInfo().getUserName());
    }
    
    /**
     * 初始化用户编码
     * @param context	
     * @return
     */
    public void onInitialize_USER_CODE(AttributeInitializeEvent context)
    {
        context.setInitialValue(this.getCurrUserInfo().getUserDN());
    }
    
    /**
     * 初始化部门名称
     * @param context	
     * @return
     */
    public void onInitialize_DEPARTMENT_NAME(AttributeInitializeEvent context)
    {
    	context.setInitialValue(this.getCurrUserInfo().getDeptName());
    }
    
    /**
     * 初始化部门编码
     * @param context	
     * @return
     */
    public void onInitialize_DEPARTMENT_CODE(AttributeInitializeEvent context)
    {
    	context.setInitialValue(this.getCurrUserInfo().getDeptCode());
    }
    
    /**
     * 初始化公司编码
     * @param context	
     * @return
     */
    public void onInitialize_SUBCOMPANY_CODE(AttributeInitializeEvent context)
    {
    	context.setInitialValue(this.getCurrUserInfo().getCompanyCode());
    }
    
    /**
     * 初始化公司名称
     * @param context	
     * @return
     */
    public void onInitialize_SUBCOMPANY_NAME(AttributeInitializeEvent context)
    {
    	context.setInitialValue(this.getCurrUserInfo().getCompanyName());
    }

    /**
     * 初始化填写时间
     * @param context	
     * @return
     */
    public void onInitialize_CREATE_TIME(AttributeInitializeEvent context)
    {
    	context.setInitialValue(CommonUtil.getSystemCurrentDate());
    }
    
    /**
     * 控制用户名只可读.
     * @param context	
     * @return
     */
    public void onDisplay_USER_NAME(AttributeAccessEvent context){
    	context.setAccess(AccessMode.READONLY);
    }
    
    /**
     * 控制用户编码只可读
     * @param context	
     * @return
     */
    public void onDisplay_USER_CODE(AttributeAccessEvent context){
    	context.setAccess(AccessMode.READONLY);
    }
   
    /**
     * 控制部门名称只可读
     * @param context	
     * @return
     */
    public void onDisplay_DEPARTMENT_NAME(AttributeAccessEvent context){
    	context.setAccess(AccessMode.READONLY);
    }
}